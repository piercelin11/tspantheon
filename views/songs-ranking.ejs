<%- include( "partials/header.ejs" ) %>

<main>

    <div class="main">
        <h1>Songs Ranking</h1>

        <!-- 日期選單，與歌曲排名表格和日期表格做互動 -->
        <div class="chart-menu">
            <% for (let dates of allDates) {%>               
                <button class="rounded">
                    <a href="/songs-ranking/<%= dates.id %>"><%= dates.date %></a> 
                </button>
            <% } %> 
        </div>
        
        <!-- 排名的日期與資訊 -->
            <div class="ranking-header">
                <div>
                    <% if (locals.currentDate) {%>
                        <p><%= currentDate.date %></p>
                        <p class="gray-text text-overflow"><%= currentDate.info %></p>
                    <% } else { %>
                        <p><%= allDates[0].date %></p>
                        <p class="gray-text text-overflow"><%= allDates[0].info %></p>
                    <% } %>
                </div>
                <div>
                    <div>
                        <% if ( locals.isCurrent) { %>
                            <p class="chart-info-hidden">peak</p> <!-- 最高排名 -->
                            <p class="chart-info-hidden">last ranking</p> <!-- 上次排名 -->
                        <% } %> 
                        <p class="chart-info-hidden">award</p> <!-- 獎座 -->                       
                    </div>                   
                </div>
            </div>
            

        <!-- 排名，用迴圈從資料庫中讀取資料 -->
        <% for (let songChartData of chartData) { %> 
            <div class="ranking-box">
                <div>
                    <span class="ranking-number" <% if ( parseInt(songChartData.currentRanking) >= 100 ) { %> style="font-size: 20px" <% } %>>#<%= songChartData.currentRanking %></span> <!-- 當前排名 -->
                    <% if (songChartData.difference !== "" && songChartData.difference !== 0 && !isNaN(songChartData.difference)) { %>
                        <div class="rank-difference">
                            <img class="icon" src="/icons/<%= songChartData.difference > 0 ? 'up' : 'down' %>.svg" alt="arrow icon" >
                            <p class="chart-info-hidden"><%= Math.abs(songChartData.difference) %></p>
                        </div> <!-- 排名變化 -->
                    <% } else { %>
                        <div class="rank-difference">
                            <img class="icon" src="/icons/<%= songChartData.lastRanking === "" ? 'debut' : 'right' %>.svg" alt="arrow icon" >
                            <p><%= songChartData.lastRanking !== "" ? Math.abs(songChartData.difference) : "" %></p>
                        </div> <!-- 排名變化 -->
                    <% } %>
                    <img src="/album-covers/<%= songChartData.albumName.toLowerCase() %>.webp" alt="Song Cover" class="ranking-cover"> <!-- 單曲封面照片 -->
                    <div class="text-overflow">
                        <h2 class="text-overflow"><%= songChartData.songName %></h2> <!-- 歌曲名 -->
                        <p class="gray-text text-overflow"><%= songChartData.albumName %></p> <!-- 專輯名 -->
                    </div>
                </div>
                <div>
                    <p class="chart-info-hidden"><%= locals.isCurrent ? songChartData.peak : "" %></p> <!-- 最高排名 -->
                    <p class="chart-info-hidden"><%= songChartData.lastRanking %></p> <!-- 上次排名 -->
                    <div class="chart-award">
                        <% if ( songChartData.currentRanking ===  songChartData.peak ) { %>
                            <img class="icon" src="/icons/peak.svg" alt="award-icon">
                        <% } if ( parseInt(songChartData.difference) >= 30 ) { %>
                            <img class="icon" src="/icons/big-climb.svg" alt="award-icon"> 
                        <% } else if ( parseInt(songChartData.difference) <= -30 ) { %>
                            <img class="icon" src="/icons/big-drop.svg" alt="award-icon">
                        <% } %>
                    </div>
                    <button class="info-button">
                        <img class="icon" src="/icons/info.svg" alt="info-icon">
                    </button> <!-- 資訊按鈕 -->
                </div>
            </div>
        <% } %>

    </div>

</main>

</body>
</html> 